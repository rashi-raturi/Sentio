<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOPI Form</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #2E3440;
            color: #D8DEE9;
            font-family: 'Arial', sans-serif;
        }
        .container {
            background-color: #3B4252;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            margin-top: 20px;
            max-width: 900px;
        }
        h1, h3 {
            text-align: center;
            color: #88C0D0;
            margin-top: 30px;
        }
        .section-title {
            color: #81A1C1;
            border-bottom: 2px solid #88C0D0;
            padding-bottom: 5px;
            margin-bottom: 15px;
            margin-top: 30px;
        }
        label {
            font-weight: bold;
        }
        input, textarea {
            background-color: #ECEFF4;
            color: #2E3440;
            border: 1px solid #4C566A;
            border-radius: 5px;
            width: 100%;
            padding: 8px;
            margin-top: 5px;
        }
        .hidden {
            display: none;
        }
        .form-group {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>HOPI Form</h1>
        <form id="hopiForm">
            <div id="formContainer">
                <h3 class="section-title">Patient Information</h3>
                <div class="form-group row">
                    <label for="nameInput" class="col-sm-3 col-form-label">Name:</label>
                    <div class="col-sm-9">
                        <input type="text" name="name" id="nameInput" value="<%= hopi ? hopi.name : '' %>" class="form-control <%= hopi ? 'hidden' : '' %>">
                        <span class="<%= hopi ? '' : 'hidden' %>" id="name"><strong><%= hopi ? hopi.name : '' %></strong></span>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="ageInput" class="col-sm-3 col-form-label">Age:</label>
                    <div class="col-sm-9">
                        <input type="text" name="age" id="ageInput" value="<%= hopi ? hopi.age : '' %>" class="form-control <%= hopi ? 'hidden' : '' %>">
                        <span class="<%= hopi ? '' : 'hidden' %>" id="age"><strong><%= hopi ? hopi.age : '' %></strong></span>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="genderInput" class="col-sm-3 col-form-label">Gender:</label>
                    <div class="col-sm-9">
                        <input type="text" name="gender" id="genderInput" value="<%= hopi ? hopi.gender : '' %>" class="form-control <%= hopi ? 'hidden' : '' %>">
                        <span class="<%= hopi ? '' : 'hidden' %>" id="gender"><strong><%= hopi ? hopi.gender : '' %></strong></span>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="maritalStatusInput" class="col-sm-3 col-form-label">Marital Status:</label>
                    <div class="col-sm-9">
                        <input type="text" name="marital_status" id="maritalStatusInput" value="<%= hopi ? hopi.marital_status : '' %>" class="form-control <%= hopi ? 'hidden' : '' %>">
                        <span class="<%= hopi ? '' : 'hidden' %>" id="marital_status"><strong><%= hopi ? hopi.marital_status : '' %></strong></span>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="educationInput" class="col-sm-3 col-form-label">Education:</label>
                    <div class="col-sm-9">
                        <input type="text" name="education" id="educationInput" value="<%= hopi ? hopi.education : '' %>" class="form-control <%= hopi ? 'hidden' : '' %>">
                        <span class="<%= hopi ? '' : 'hidden' %>" id="education"><strong><%= hopi ? hopi.education : '' %></strong></span>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="occupationInput" class="col-sm-3 col-form-label">Occupation:</label>
                    <div class="col-sm-9">
                        <input type="text" name="occupation" id="occupationInput" value="<%= hopi ? hopi.occupation : '' %>" class="form-control <%= hopi ? 'hidden' : '' %>">
                        <span class="<%= hopi ? '' : 'hidden' %>" id="occupation"><strong><%= hopi ? hopi.occupation : '' %></strong></span>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="religionInput" class="col-sm-3 col-form-label">Religion:</label>
                    <div class="col-sm-9">
                        <input type="text" name="religion" id="religionInput" value="<%= hopi ? hopi.religion : '' %>" class="form-control <%= hopi ? 'hidden' : '' %>">
                        <span class="<%= hopi ? '' : 'hidden' %>" id="religion"><strong><%= hopi ? hopi.religion : '' %></strong></span>
                    </div>
                </div>
                <h3 class="section-title">Presenting Complaint</h3>
                <div class="form-group row">
                    <label for="presentingComplaintInput" class="col-sm-3 col-form-label">Presenting Complaint:</label>
                    <div class="col-sm-9">
                        <textarea rows="3" name="presenting_complaint" id="presentingComplaintInput" class="form-control <%= hopi ? 'hidden' : '' %>"><%= hopi ? hopi.presenting_complaint : '' %></textarea>
                        <span class="<%= hopi ? '' : 'hidden' %>" id="presenting_complaint"><strong><%= hopi ? hopi.presenting_complaint : '' %></strong></span>
                    </div>
                </div>
                <h3 class="section-title">History of Present Illness</h3>
                <div class="form-group row">
                    <label for="historyPresentIllnessInput" class="col-sm-3 col-form-label">History of Present Illness:</label>
                    <div class="col-sm-9">
                        <textarea rows="4" name="history_present_illness" id="historyPresentIllnessInput" class="form-control <%= hopi ? 'hidden' : '' %>"><%= hopi ? hopi.history_present_illness : '' %></textarea>
                        <span class="<%= hopi ? '' : 'hidden' %>" id="history_present_illness"><strong><%= hopi ? hopi.history_present_illness : '' %></strong></span>
                    </div>
                </div>
                <h3 class="section-title">Past History (Psychiatric/Medical)</h3>
                <div class="form-group row">
                    <label for="pastHistoryInput" class="col-sm-3 col-form-label">Past History:</label>
                    <div class="col-sm-9">
                        <textarea rows="3" name="past_history" id="pastHistoryInput" class="form-control <%= hopi ? 'hidden' : '' %>"><%= hopi ? hopi.past_history : '' %></textarea>
                        <span class="<%= hopi ? '' : 'hidden' %>" id="past_history"><strong><%= hopi ? hopi.past_history : '' %></strong></span>
                    </div>
                </div>
                <h3 class="section-title">Family History</h3>
                <div class="form-group row">
                    <label for="familyHistoryInput" class="col-sm-3 col-form-label">Family History:</label>
                    <div class="col-sm-9">
                        <textarea rows="3" name="family_history" id="familyHistoryInput" class="form-control <%= hopi ? 'hidden' : '' %>"><%= hopi ? hopi.family_history : '' %></textarea>
                        <span class="<%= hopi ? '' : 'hidden' %>" id="family_history"><strong><%= hopi ? hopi.family_history : '' %></strong></span>
                    </div>
                </div>
                <h3 class="section-title">Personal History</h3>
                <div class="form-group row">
                    <label for="childhoodHistoryInput" class="col-sm-3 col-form-label">Childhood:</label>
                    <div class="col-sm-9">
                        <textarea rows="3" name="childhood_history" id="childhoodHistoryInput" class="form-control <%= hopi ? 'hidden' : '' %>"><%= hopi ? hopi.childhood_history : '' %></textarea>
                        <span class="<%= hopi ? '' : 'hidden' %>" id="childhood_history"><strong><%= hopi ? hopi.childhood_history : '' %></strong></span>
                    </div>
                </div>
                <h3 class="section-title">Adulthood</h3>
                <div class="form-group row">
                    <label for="occupationalHistoryInput" class="col-sm-3 col-form-label">Occupational History:</label>
                    <div class="col-sm-9">
                        <textarea rows="2" name="occupational_history" id="occupationalHistoryInput" class="form-control <%= hopi ? 'hidden' : '' %>"><%= hopi ? hopi.occupational_history : '' %></textarea>
                        <span class="<%= hopi ? '' : 'hidden' %>" id="occupational_history"><strong><%= hopi ? hopi.occupational_history : '' %></strong></span>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="socialActivityInput" class="col-sm-3 col-form-label">Social Activity:</label>
                    <div class="col-sm-9">
                        <textarea rows="2" name="social_activity" id="socialActivityInput" class="form-control <%= hopi ? 'hidden' : '' %>"><%= hopi ? hopi.social_activity : '' %></textarea>
                        <span class="<%= hopi ? '' : 'hidden' %>" id="social_activity"><strong><%= hopi ? hopi.social_activity : '' %></strong></span>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="religiousHistoryInput" class="col-sm-3 col-form-label">Religious History:</label>
                    <div class="col-sm-9">
                        <textarea rows="2" name="religious_history" id="religiousHistoryInput" class="form-control <%= hopi ? 'hidden' : '' %>"><%= hopi ? hopi.religious_history : '' %></textarea>
                        <span class="<%= hopi ? '' : 'hidden' %>" id="religious_history"><strong><%= hopi ? hopi.religious_history : '' %></strong></span>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="preMorbidPersonalityInput" class="col-sm-3 col-form-label">Pre-Morbid Personality:</label>
                    <div class="col-sm-9">
                        <textarea rows="2" name="pre_morbid_personality" id="preMorbidPersonalityInput" class="form-control <%= hopi ? 'hidden' : '' %>"><%= hopi ? hopi.pre_morbid_personality : '' %></textarea>
                        <span class="<%= hopi ? '' : 'hidden' %>" id="pre_morbid_personality"><strong><%= hopi ? hopi.pre_morbid_personality : '' %></strong></span>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="maritalSexualHistoryInput" class="col-sm-3 col-form-label">Marital/Sexual History:</label>
                    <div class="col-sm-9">
                        <textarea rows="2" name="marital_sexual_history" id="maritalSexualHistoryInput" class="form-control <%= hopi ? 'hidden' : '' %>"><%= hopi ? hopi.marital_sexual_history : '' %></textarea>
                        <span class="<%= hopi ? '' : 'hidden' %>" id="marital_sexual_history"><strong><%= hopi ? hopi.marital_sexual_history : '' %></strong></span>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="substanceUseHistoryInput" class="col-sm-3 col-form-label">Substance Use History:</label>
                    <div class="col-sm-9">
                        <textarea rows="3" name="substance_use_history" id="substanceUseHistoryInput" class="form-control <%= hopi ? 'hidden' : '' %>"><%= hopi ? hopi.substance_use_history : '' %></textarea>
                        <span class="<%= hopi ? '' : 'hidden' %>" id="substance_use_history"><strong><%= hopi ? hopi.substance_use_history : '' %></strong></span>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary mt-3 <%= hopi ? 'hidden' : '' %>">Submit</button>
            </div>
        </form>
        <button id="editButton" class="btn btn-warning mt-3 <%= hopi ? '' : 'hidden' %>">Edit</button>
    </div>

    <script>
        document.getElementById('hopiForm').addEventListener('submit', function(event) {
            event.preventDefault();
            let formData = {};
            let inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                formData[input.name] = input.value;
                let span = document.getElementById(input.name);
                span.innerHTML = `<strong>${input.value}</strong>`;
                span.classList.remove('hidden');
                input.classList.add('hidden');
            });
            document.querySelector('button[type="submit"]').classList.add('hidden');
            document.getElementById('editButton').classList.remove('hidden');

            const method = '<%= hopi ? "PUT" : "POST" %>';
            fetch('/information/<%=patient_id%>/hopi', {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Error:', error));
        });

        document.getElementById('editButton').addEventListener('click', function() {
            let inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                let span = document.getElementById(input.name);
                input.value = span.textContent;
                span.classList.add('hidden');
                input.classList.remove('hidden');
            });
            document.querySelector('button[type="submit"]').classList.remove('hidden');
            document.getElementById('editButton').classList.add('hidden');
        });
    </script>
</body>
</html>